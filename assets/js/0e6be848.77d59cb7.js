"use strict";(self.webpackChunksite_docusaurus_template=self.webpackChunksite_docusaurus_template||[]).push([[8301],{82223:(e,n,t)=>{t.d(n,{A:()=>r});t(96540);var s=t(18215);const a={tabItem:"tabItem_Ymn6"};var i=t(74848);function r(e){let{children:n,hidden:t,className:r}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,s.A)(a.tabItem,r),hidden:t,children:n})}},72206:(e,n,t)=>{t.d(n,{A:()=>w});var s=t(96540),a=t(18215),i=t(80052),r=t(56347),o=t(35793),c=t(99025),l=t(4430),d=t(44148);function h(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:n,children:t}=e;return(0,s.useMemo)((()=>{const e=n??function(e){return h(e).map((e=>{let{props:{value:n,label:t,attributes:s,default:a}}=e;return{value:n,label:t,attributes:s,default:a}}))}(t);return function(e){const n=(0,l.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function p(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:t}=e;const a=(0,r.W6)(),i=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,c.aZ)(i),(0,s.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(a.location.search);n.set(i,e),a.replace({...a.location,search:n.toString()})}),[i,a])]}function g(e){const{defaultValue:n,queryString:t=!1,groupId:a}=e,i=u(e),[r,c]=(0,s.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const s=t.find((e=>e.default))??t[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:n,tabValues:i}))),[l,h]=m({queryString:t,groupId:a}),[g,j]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[a,i]=(0,d.Dv)(t);return[a,(0,s.useCallback)((e=>{t&&i.set(e)}),[t,i])]}({groupId:a}),x=(()=>{const e=l??g;return p({value:e,tabValues:i})?e:null})();(0,o.A)((()=>{x&&c(x)}),[x]);return{selectedValue:r,selectValue:(0,s.useCallback)((e=>{if(!p({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);c(e),h(e),j(e)}),[h,j,i]),tabValues:i}}var j=t(75251);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=t(74848);function v(e){let{className:n,block:t,selectedValue:s,selectValue:r,tabValues:o}=e;const c=[],{blockElementScrollPositionUntilNextRender:l}=(0,i.a_)(),d=e=>{const n=e.currentTarget,t=c.indexOf(n),a=o[t].value;a!==s&&(l(n),r(a))},h=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=c.indexOf(e.currentTarget)+1;n=c[t]??c[0];break}case"ArrowLeft":{const t=c.indexOf(e.currentTarget)-1;n=c[t]??c[c.length-1];break}}n?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":t},n),children:o.map((e=>{let{value:n,label:t,attributes:i}=e;return(0,b.jsx)("li",{role:"tab",tabIndex:s===n?0:-1,"aria-selected":s===n,ref:e=>{c.push(e)},onKeyDown:h,onClick:d,...i,className:(0,a.A)("tabs__item",x.tabItem,i?.className,{"tabs__item--active":s===n}),children:t??n},n)}))})}function f(e){let{lazy:n,children:t,selectedValue:i}=e;const r=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=r.find((e=>e.props.value===i));return e?(0,s.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:r.map(((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==i})))})}function y(e){const n=g(e);return(0,b.jsxs)("div",{className:(0,a.A)("tabs-container",x.tabList),children:[(0,b.jsx)(v,{...n,...e}),(0,b.jsx)(f,{...n,...e})]})}function w(e){const n=(0,j.A)();return(0,b.jsx)(y,{...e,children:h(e.children)},String(n))}},99706:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>h,default:()=>g,frontMatter:()=>d,metadata:()=>s,toc:()=>p});const s=JSON.parse('{"id":"teen/scriptobjgamearch","title":"ScriptableObject Game Architecture","description":"The lab handout uses Super Mario Bros as assets to demonstrate certain Unity features and functionalities. You are free to follow along and submit it for checkoff, OR you can also create an entirely new project to demonstrate the requested feature(s).","source":"@site/docs/05-teen/scriptobjgamearch.md","sourceDirName":"05-teen","slug":"/teen/scriptobjgamearch","permalink":"/50033/docs/teen/scriptobjgamearch","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Unity for Teens","permalink":"/50033/docs/category/unity-for-teens"},"next":{"title":"Finite State Machine","permalink":"/50033/docs/teen/fsm"}}');var a=t(74848),i=t(28453),r=(t(53398),t(19894),t(88761)),o=(t(89166),t(384)),c=t(72206),l=t(82223);const d={sidebar_position:1},h="ScriptableObject Game Architecture",u={},p=[{value:"Preparation",id:"preparation",level:2},{value:"The Singleton Architecture",id:"the-singleton-architecture",level:2},{value:"Powerup Collection",id:"powerup-collection",level:3},{value:"Score Update",id:"score-update",level:3},{value:"Thoughts",id:"thoughts",level:2},{value:"Scriptable Object Game Architecture",id:"scriptable-object-game-architecture",level:2},{value:"Scriptable Object Event System",id:"scriptable-object-event-system",level:3},{value:"Create Subclasses that Pins <code>T</code>",id:"create-subclasses-that-pins-t",level:4},{value:"Create Game Events",id:"create-game-events",level:3},{value:"Subscribe/Register to Game Events with GameEventListener",id:"subscriberegister-to-game-events-with-gameeventlistener",level:3},{value:"Raising the GameEvent",id:"raising-the-gameevent",level:3},{value:"Method 1: Using UnityEvent (No Params)",id:"method-1-using-unityevent-no-params",level:4},{value:"Method 2: Direct Reference Approach",id:"method-2-direct-reference-approach",level:4},{value:"Key Distinction",id:"key-distinction",level:4},{value:"Migrate",id:"migrate",level:2},{value:"Summary",id:"summary",level:2}];function m(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"scriptableobject-game-architecture",children:"ScriptableObject Game Architecture"})}),"\n",(0,a.jsxs)(n.admonition,{title:"Lab Checkoff Requirements",type:"caution",children:[(0,a.jsxs)(n.p,{children:["The lab handout uses Super Mario Bros as assets to demonstrate certain Unity features and functionalities. You are free to follow along and submit it for checkoff, ",(0,a.jsx)(n.strong,{children:"OR you can also create an entirely new project to demonstrate the requested feature(s)"}),"."]}),(0,a.jsxs)(n.p,{children:["The requirement(s) for the lab checkoff can be found ",(0,a.jsx)(n.a,{href:"/50033/docs/teen/checkoff",children:"here"}),"."]})]}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["This ",(0,a.jsx)(n.a,{href:"https://www.youtube.com/watch?v=raQ3iHhE_Kk",children:"amazing talk"})," inspires the existence of this section. We simply do not have enough time (unfortunately) to go into every single detailed implementation of common concepts such as game inventory, skill tree, etc but we hope that this quick introduction will point you into the right direction in the future."]})}),"\n",(0,a.jsxs)(n.p,{children:["This topic covers an entirely new game architecture which separates data from code to make your game more maintainable and all around pleasant to work with. You can choose to go down the Singleton Pattern Path for some appropriate parts of your project and utilise SO Architecture for others. The SO Architecture is ",(0,a.jsx)("span",{className:"orange-bold",children:"not"})," strictly a replacement for the Singleton Pattern."]}),"\n",(0,a.jsxs)(n.p,{children:["For example, Singleton Pattern and static pattern is ideal when you have a cache or repository for frequently accessed data (e.g., a level cache, asset loader, or a global configuration), as they can provide easy access from anywhere in the game without passing references explicitly. Singleton can be helpful to maintain ",(0,a.jsx)("span",{className:"orange-bold",children:"consistency"})," and ",(0,a.jsx)("span",{className:"orange-bold",children:"centralize control"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["On the other hand, SO Architecture is superior in promoting modularity and reusability, such as when you are creating different enemy types or power-ups, or creating ",(0,a.jsx)(n.strong,{children:"reusable"})," systems like event systems, dialogue systems, or inventory management systems that can be easily shared between different game elements. The SO Architecture provide for easy tweaking and tuning without code changes."]}),"\n",(0,a.jsx)(n.p,{children:"The decision regarding which approach to embrace is entirely yours. However, we take it upon ourselves to introduce you to another excellent game architecture leveraging Scriptable Objects. You'll need to overhaul your current lab project, but the advantages make it worthwhile:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Scenes are clean slates"}),"\n",(0,a.jsx)(n.li,{children:"No dependency between Systems and they are modular"}),"\n",(0,a.jsx)(n.li,{children:"Prefabs work on their own"}),"\n",(0,a.jsx)(n.li,{children:"Pluggable custom components"}),"\n"]}),"\n",(0,a.jsx)(n.admonition,{title:"Prototyping with your project idea",type:"note",children:(0,a.jsx)(n.p,{children:"Since you would have to start prototyping your project anyway, it will be good to apply this week's lab for that. Think about small features in your game that you need to implement as proof of concept. However, feel free to still follow along and use the Mario assets if you want."})}),"\n",(0,a.jsx)(n.h2,{id:"preparation",children:"Preparation"}),"\n",(0,a.jsxs)(n.p,{children:["We need at least two Scenes with completely clean slate. That\u2019s right. ",(0,a.jsx)("span",{className:"orange-bold",children:"Clean Slates"}),". We can\u2019t reuse any of these Scripts anymore: GameManager, PowerupController, PlayerController, etc. To get you up to speed, you can:"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Copy your main menu or loading scene if any, and World-1-1 and World-1-2 into a new folder"}),"\n",(0,a.jsx)(n.li,{children:"Copy all prefabs used in these two worlds into a new folder, name it something else"}),"\n",(0,a.jsx)(n.li,{children:"Replace the prefabs with the new prefabs (same, just another copy)"}),"\n",(0,a.jsxs)(n.li,{children:["Remove ",(0,a.jsx)(n.strong,{children:"all scripts"})," attached to any GameObject, do the same for the new set of prefabs"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Here's a complete recording on what we do to prepare for this lab. Lots of the setup is about step 3 above. If you want to simply copy the entire project and work on the copy directly, you may do so."}),"\n",(0,a.jsx)(o.A,{path:"https://50033.s3.ap-southeast-1.amazonaws.com/week-5/setup.mp4",widthPercentage:"100%"}),"\n",(0,a.jsx)(n.admonition,{type:"playtest",children:(0,a.jsxs)(n.p,{children:["If your main menu and loading screen is simple, you may leave it as-is. Some error might pop up because the event called in some animation clip, e.g: mario-jump animation doesn't exist and it's fine. We can fix that later. Also, do not forget to update the ",(0,a.jsx)(n.strong,{children:"build setting"})," to include these new scenes instead. The setting can be found at File >> Build Settings."]})}),"\n",(0,a.jsx)(n.h2,{id:"the-singleton-architecture",children:"The Singleton Architecture"}),"\n",(0,a.jsx)(n.p,{children:"If you've been following the lab faithfully so far, your current game architecture utilising Singletons is somewhat as follows:"}),"\n",(0,a.jsx)(r.A,{path:t(69122).A,customClass:"invert-color",widthPercentage:"100%"}),"\n",(0,a.jsxs)(n.p,{children:["It's ",(0,a.jsx)(n.em,{children:"decent"}),", in a way that there's no cross-referencing between scripts attached to gameObject instances, ",(0,a.jsx)(n.strong,{children:"except"})," to Singletons: ",(0,a.jsx)(n.code,{children:"GameManager"})," and ",(0,a.jsx)(n.code,{children:"PowerupManager"}),". Most chain of actions are triggered via events. Let's recap the event flow for powerup-related events and score change."]}),"\n",(0,a.jsx)(n.h3,{id:"powerup-collection",children:"Powerup Collection"}),"\n",(0,a.jsxs)(n.p,{children:["Every Powerup box (brick or question box) is controlled by a script inheriting ",(0,a.jsx)(n.code,{children:"BasePowerupController"}),"."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Whenever Mario hits a box (brick or question box), the ",(0,a.jsx)(n.code,{children:"OnCollisionEnter2D"})," will be called by Unity, which will trigger an ",(0,a.jsx)("span",{className:"orange-bold",children:"Animation"})," (bouncing box, etc)."]}),"\n",(0,a.jsxs)(n.li,{children:["From this animation, we call ",(0,a.jsx)(n.code,{children:"SpawnPowerup()"})," on the powerup inside the box. Any powerup (coin, starman, magic mushroom, and one-up mushroom) are spawned via ",(0,a.jsx)(n.code,{children:"SpawnPowerup()"})," method. ",(0,a.jsx)(n.code,{children:"SpawnPowerup()"})," ",(0,a.jsx)(n.strong,{children:"invokes"})," ",(0,a.jsx)(n.code,{children:"powerupCollected"})," event in PowerupManager Singleton, passing ",(0,a.jsx)(n.strong,{children:"reference"})," to itself in the process"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["This calls the subscribers of ",(0,a.jsx)(n.code,{children:"powerupCollected"}),": ",(0,a.jsx)(n.code,{children:"FilterAndCastPowerup"})," which decides whether to invoke ",(0,a.jsx)(n.code,{children:"powerupAffectsManager"})," or ",(0,a.jsx)(n.code,{children:"powerupAffectsPlayer"})," based on the type of powerup invoking the event."]}),"\n",(0,a.jsxs)(n.p,{children:["The subscribers of ",(0,a.jsx)(n.code,{children:"powerupAffectsPlayer"})," or ",(0,a.jsx)(n.code,{children:"powerupAffectsManager"})," (Mario or Manager) will then be called. Any gameObject subscribing to these two ",(0,a.jsx)(n.code,{children:"powerupAffectsX"})," event should conform to ",(0,a.jsx)(n.code,{children:"IPowerupApplicable"})," interface containing ",(0,a.jsx)(n.code,{children:"RequestPowerupEffect"})," method, which is the method subscribing to ",(0,a.jsx)(n.code,{children:"powerupAffectsX"})," event."]}),"\n",(0,a.jsxs)(n.p,{children:["In ",(0,a.jsx)(n.code,{children:"RequestPowerupEffect"}),", one simply passes itself (",(0,a.jsx)(n.code,{children:"this"}),") to the powerup triggering the chain of events from the start by calling ",(0,a.jsx)(n.code,{children:"i.ApplyPowerup(this)"}),". Then, the ",(0,a.jsx)(n.strong,{children:"actual"})," implementation (how this powerup is affecting ",(0,a.jsx)(n.code,{children:"this"}),") is implemented in that powerup script itself."]}),"\n",(0,a.jsxs)(n.p,{children:["For instance, when Mario hits a question box containing MagicMushroom, it triggers ",(0,a.jsx)(n.code,{children:"SpawnPowerup()"})," which will animate the spawning of the MagicMushroom."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["When Mario ",(0,a.jsx)("span",{className:"orange-bold",children:"collides"})," with the MagicMushroom, ",(0,a.jsx)(n.code,{children:"OnCollisionEnter2D"})," on MagicMushroom's BasePowerup will be triggered, which will ",(0,a.jsx)(n.strong,{children:"invoke"})," ",(0,a.jsx)(n.code,{children:"powerupCollected"})," event, passing itself in the process."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"FilterAndCastPowerup"})," (",(0,a.jsx)("span",{className:"orange-bold",children:"subscriber"})," of ",(0,a.jsx)(n.code,{children:"powerupCollected"}),") will examine the ",(0,a.jsx)(n.code,{children:"PowerupType"})," triggering this event (which is MagicMushroom) and hence it ",(0,a.jsx)("span",{className:"orange-bold",children:"invokes"})," ",(0,a.jsx)(n.code,{children:"powerupAffectsPlayer"})," event, passing MagicMushroom instance as the argument."]}),"\n",(0,a.jsxs)(n.li,{children:["This ",(0,a.jsx)("span",{className:"orange-bold",children:"triggers"})," the callback ",(0,a.jsx)(n.code,{children:"RequestPowerupEffect"})," in ",(0,a.jsx)(n.code,{children:"PlayerMovement.cs"})," attached on Mario.","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["In ",(0,a.jsx)(n.code,{children:"RequestPowerupEffect"}),", we pass ",(0,a.jsx)(n.code,{children:"this"})," (which is Mario gameobject instance) to MagicMushroom via ",(0,a.jsx)(n.code,{children:"ApplyPowerup"})," method."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Finally, in the MagicMushroomPowerup script we can decide ",(0,a.jsx)(n.em,{children:"what the effect of this powerup is to Mario"}),": which is to call ",(0,a.jsx)(n.code,{children:"MakeSuperMario()"})," method implemented in ",(0,a.jsx)(n.code,{children:"PlayerMovement"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsx)(n.p,{children:"This is just one of the suggested method to prevent cross-referencing of scripts that needed to be done manually via inspector during runtime. The main idea is to modularise the implementation of the powerup effect as much as possible, implementing parts concerning that instances in the instance script and nowhere else. For instance: it is the MagicMushroom's responsibility to call Mario's: MakeSuperMario, and it is Mario's responsibility to decide what \"Super Mario\" should be."})}),"\n",(0,a.jsx)(n.h3,{id:"score-update",children:"Score Update"}),"\n",(0,a.jsxs)(n.p,{children:["There are two ways currently to increase the current score: by stomping on Goomba from above or spawning a coin. Both ",(0,a.jsx)(n.code,{children:"EnemyController"})," and ",(0,a.jsx)(n.code,{children:"CoinPowerup"})," calls ",(0,a.jsx)(n.code,{children:"GameManager.instance.IncreaseScore(int value)"})," anytime those conditions are valid. This calls the ",(0,a.jsx)(n.code,{children:"SetScore"})," method inside ",(0,a.jsx)(n.code,{children:"GameManager"}),", which invokes the ",(0,a.jsx)(n.code,{children:"scoreChange"})," event and eventually triggers its subscriber: ",(0,a.jsx)(n.code,{children:"SetScore"})," in ",(0,a.jsx)(n.code,{children:"HUDManager"})," to update the UI. The actual score is stored at ",(0,a.jsx)(n.code,{children:"GameScore"}),", an ",(0,a.jsx)(n.code,{children:"IntVariable"})," Scriptable Object, which is updated inside ",(0,a.jsx)(n.code,{children:"IncreaseScore"})," method."]}),"\n",(0,a.jsx)(n.h2,{id:"thoughts",children:"Thoughts"}),"\n",(0,a.jsxs)(n.p,{children:["The Singleton pattern ensures that a class has only one instance and provides a global point of access to that instance. In Unity, it is often used to manage game-wide systems or managers that need to exist throughout the entire game's lifetime. They are commonly used for managing things like GameManager, AudioManager, UIManager, InputManager, and other central systems. These classes need to be accessible from different parts of the game, and a Singleton pattern ensures there is only one instance to coordinate these tasks. It is relatively easy to implement, but can lead to ",(0,a.jsx)("span",{className:"orange-bold",children:"tight coupling"})," between the systems as discussed before. It can also be cumbersome to sharing data between different scenes or across multiple game objects."]}),"\n",(0,a.jsxs)(n.p,{children:["We also utilise some Scriptable Objects to manage data assets (like score) that can be shared across different parts of the game, including scenes, game objects, and scripts. They are primarily used for ",(0,a.jsx)(n.em,{children:"storing"})," and ",(0,a.jsx)(n.em,{children:"sharing"})," data."]}),"\n",(0,a.jsx)(n.h2,{id:"scriptable-object-game-architecture",children:"Scriptable Object Game Architecture"}),"\n",(0,a.jsxs)(n.p,{children:["In this new game architecture, we take everything one step further to promote a more modular and decoupled architecture. There's ",(0,a.jsx)(n.strong,{children:"no"})," interaction between scripts (well, at least not between scripts of unrelated gameObjects, interaction between scripts in the same perfab is understandable)."]}),"\n",(0,a.jsxs)(n.p,{children:["We first create various ",(0,a.jsx)(n.code,{children:"GameEvents"})," based on Scriptable Objects. Each instance can subscribe to it ",(0,a.jsx)(n.code,{children:"OnEnable()"}),", and unsubscribe from it ",(0,a.jsx)(n.code,{children:"OnDisable()"}),". As per the previous lab, we also use SO to store persistent runtime data so that new instances in the next scene can load values from there. This way, we do not need to implement any object as a Singleton."]}),"\n",(0,a.jsxs)(n.admonition,{type:"note",children:[(0,a.jsx)(n.mdxAdmonitionTitle,{}),(0,a.jsxs)(n.p,{children:["Creating events and storing it in SO as opposed to creating UnityEvents allow us to ",(0,a.jsx)(n.em,{children:"store"})," references of listeners without having to tie the events onto an existing GameObject on the Scene."]}),(0,a.jsxs)(n.p,{children:["This is actually the main reason the ScriptableObject-based event pattern exists. It ",(0,a.jsx)("span",{class:"orange-bold",children:"decouples"})," the event system from specific scene objects."]})]}),"\n",(0,a.jsx)(n.p,{children:"A sketch of the architecture is as follows:"}),"\n",(0,a.jsx)(r.A,{path:t(11716).A,customClass:"invert-color",widthPercentage:"100%"}),"\n",(0,a.jsx)(n.h3,{id:"scriptable-object-event-system",children:"Scriptable Object Event System"}),"\n",(0,a.jsxs)(n.p,{children:["Create two new scripts called ",(0,a.jsx)(n.code,{children:"GameEvent.cs"})," and ",(0,a.jsx)(n.code,{children:"GameEventListener.cs"}),". This SO-based event will store a ",(0,a.jsx)(n.strong,{children:"list"})," of ",(0,a.jsx)(n.code,{children:"GameEventListeners"}),", and notify them whenever the GameEvent is ",(0,a.jsx)(n.strong,{children:"Raised"}),"."]}),"\n",(0,a.jsxs)(c.A,{children:[(0,a.jsx)(l.A,{value:"1",label:"GameEvent.cs",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cs",children:"using System.Collections.Generic;\nusing Unity.VisualScripting;\nusing UnityEngine;\n\n\npublic class GameEvent<T> : ScriptableObject\n{\n    private readonly List<GameEventListener<T>> eventListeners =\n        new List<GameEventListener<T>>();\n\n    public void Raise(T data)\n    {\n        for (int i = eventListeners.Count - 1; i >= 0; i--)\n            eventListeners[i].OnEventRaised(data);\n    }\n\n    public void RegisterListener(GameEventListener<T> listener)\n    {\n        if (!eventListeners.Contains(listener))\n            eventListeners.Add(listener);\n    }\n\n    public void UnregisterListener(GameEventListener<T> listener)\n    {\n        if (eventListeners.Contains(listener))\n            eventListeners.Remove(listener);\n    }\n}\n"})})}),(0,a.jsx)(l.A,{value:"2",label:"GameEventListener.cs",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cs",children:"\nusing UnityEngine;\nusing UnityEngine.Events;\n\n// if attached to an object that might be disabled, callback will not work\n// attach it on a parent object that wont be disabled\npublic class GameEventListener<T> : MonoBehaviour\n{\n    public GameEvent<T> Event;\n\n    public UnityEvent<T> Response;\n\n    private void OnEnable()\n    {\n        Event.RegisterListener(this);\n    }\n\n    // This is also called when the object is destroyed and can be used for any cleanup code. When scripts are reloaded after compilation has finished, OnDisable will be called, followed by an OnEnable after the script has been loaded.\n    private void OnDisable()\n    {\n        Event.UnregisterListener(this);\n    }\n\n    public void OnEventRaised(T data)\n    {\n        Response.Invoke(data);\n    }\n}\n\n"})})})]}),"\n",(0,a.jsxs)(n.p,{children:["These are currently of a ",(0,a.jsx)(n.code,{children:"generic"})," type because ",(0,a.jsx)(n.code,{children:"UnityEvent"})," can have any varying signature: zero parameter, one parameter, etc."]}),"\n",(0,a.jsxs)(n.h4,{id:"create-subclasses-that-pins-t",children:["Create Subclasses that Pins ",(0,a.jsx)(n.code,{children:"T"})]}),"\n",(0,a.jsx)(n.p,{children:"The goal of this architecture is to conveniently add the listener script as components and then drag and drop the SO events via the inspector to link up the callbacks as such:"}),"\n",(0,a.jsx)(r.A,{path:t(5988).A,widthPercentage:"100%"}),"\n",(0,a.jsxs)(n.p,{children:["However, you ",(0,a.jsx)("span",{class:"red-bold",children:"cannot"})," drag a ",(0,a.jsx)(n.code,{children:"GameEvent<T>"})," into the Inspector unless ",(0,a.jsx)(n.code,{children:"T"})," is already known (Unity can\u2019t serialize open generic fields)."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"By subclassing, you \u201cfix\u201d the generic parameter at design time"}),"\n",(0,a.jsxs)(n.li,{children:["Unity then treats IntGameEvent or ",(0,a.jsx)(n.code,{children:"SimpleGameEvent"})," like any other ScriptableObject asset"]}),"\n"]}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:["Unity won\u2019t show open generics in the Inspector. You always need to give it a ",(0,a.jsx)(n.strong,{children:"concrete"})," type. Therefore you need a subclass that pins ",(0,a.jsx)(n.code,{children:"T"}),"."]})}),"\n",(0,a.jsxs)(n.p,{children:["For the sake of the lab, we need at least ",(0,a.jsx)(n.em,{children:"three"})," different types: no argument, a single ",(0,a.jsx)(n.code,{children:"int"})," type argument, and a single ",(0,a.jsx)(n.code,{children:"IPowerup"})," type argument. For each type, we need a pair of scripts: the GameEvent and the GameEventListener variant."]}),"\n",(0,a.jsxs)(n.p,{children:['The following creates the "no argument" (custom ',(0,a.jsx)(n.code,{children:"Void"}),") variant:"]}),"\n",(0,a.jsxs)(c.A,{children:[(0,a.jsx)(l.A,{value:"1",label:"SimpleGameEvent.cs",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cs",children:'using System.Collections;\nusing System.Collections.Generic;\nusing UnityEngine;\n\npublic class Void { } // dummy class\n// no arguments\n[CreateAssetMenu(fileName = "SimpleGameEvent", menuName = "ScriptableObjects/SimpleGameEvent", order = 3)]\npublic class SimpleGameEvent : GameEvent<Void>\n{\n    // create new method that doesn\'t accept any argument\n    // calls base\' Raise with Void arg\n    public void Raise() => Raise(new Void()); // automatically create new Void data instead\n}\n'})})}),(0,a.jsx)(l.A,{value:"2",label:"SimpleGameEventListener.cs",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cs",children:"using System.Collections;\nusing System.Collections.Generic;\nusing UnityEngine;\n\npublic class SimpleGameEventListener : GameEventListener<Void>\n{\n\n}\n"})})})]}),"\n",(0,a.jsxs)(n.p,{children:["Do the same for the other two types (",(0,a.jsx)(n.code,{children:"int"})," and ",(0,a.jsx)(n.code,{children:"IPowerup"}),")."]}),"\n",(0,a.jsx)(o.A,{path:"https://50033.s3.ap-southeast-1.amazonaws.com/week-5/setup-events.mp4",widthPercentage:"100%"}),"\n",(0,a.jsx)(n.h3,{id:"create-game-events",children:"Create Game Events"}),"\n",(0,a.jsx)(n.p,{children:"When done, create some SO Game Events as follows (your actual number of events may vary, but if we follow the suggested diagram then you shall make 11 events). Rename them properly based on their type."}),"\n",(0,a.jsx)(o.A,{path:"https://50033.s3.ap-southeast-1.amazonaws.com/week-5/create-game-events.mp4",widthPercentage:"100%"}),"\n",(0,a.jsx)(n.h3,{id:"subscriberegister-to-game-events-with-gameeventlistener",children:"Subscribe/Register to Game Events with GameEventListener"}),"\n",(0,a.jsxs)(n.p,{children:["Once created, each ",(0,a.jsx)(n.code,{children:"GameEvent"}),' serves as a "container" that store a list of GameEventListeners. Whenever any script calls their ',(0,a.jsx)(n.code,{children:"Raise"})," method, it will call the ",(0,a.jsx)(n.code,{children:"OnEventsRaised"})," method on all of its GameEventListener (subscribers), which will then call a list of methods registered under ",(0,a.jsx)(n.code,{children:"Response"})," in ",(0,a.jsx)(n.code,{children:"GameEventListener"}),". For instance, we want to ",(0,a.jsx)(n.strong,{children:"reset"})," our Camera to its starting location whenever ",(0,a.jsx)(n.code,{children:"OnGameRestart"})," event is Raised. When we were using the Singleton Method, we first register some callback ",(0,a.jsx)(n.code,{children:"GameRestart()"})," in ",(0,a.jsx)(n.code,{children:"CameraController.cs"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cs",metastring:'title="CameraController.cs" showLineNumbers',children:"    void Start()\n    {\n        GameManager.instance.gameRestart.AddListener(GameRestart);\n    }\n\n    void GameRestart()\n    {\n        // reset camera position\n        transform.position = startPosition;\n    }\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Delete"})," line 3 above, and we register ",(0,a.jsx)(n.code,{children:"GameRestart"})," as a callback to ",(0,a.jsx)(n.code,{children:"OnGameRestart"})," Game Event using ",(0,a.jsx)(n.code,{children:"SimpleGameEventListener"})," Script component as follows:"]}),"\n",(0,a.jsx)(r.A,{path:t(32467).A,widthPercentage:"100%"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"Event"})," field of the SimpleGameEventListener script is linked to ",(0,a.jsx)(n.code,{children:"OnGameRestart"})," SO GameEvent, and as its ",(0,a.jsx)(n.code,{children:"Response"}),", we register ",(0,a.jsx)(n.code,{children:"CameraController"}),"'s ",(0,a.jsx)(n.code,{children:"GameRestart()"})," method. When another script calls ",(0,a.jsx)(n.code,{children:"OnGameRestart.Raise()"}),", this will automatically cause ",(0,a.jsx)(n.code,{children:"OnGameRestart"})," to loop through its ",(0,a.jsx)(n.code,{children:"SimpleEventGameListeners"})," and call ",(0,a.jsx)(n.code,{children:"OnEventRaised()"})," on it. This will then trigger ",(0,a.jsx)(n.code,{children:"Response.Invoke()"})," where ",(0,a.jsx)(n.code,{children:"Response"})," contains ",(0,a.jsx)(n.code,{children:"GameRestart()"})," method from ",(0,a.jsx)(n.code,{children:"CameraController"}),". Finally, the method ",(0,a.jsx)(n.code,{children:"GameRestart()"})," is performed on the ",(0,a.jsx)(n.code,{children:"CameraController"}),"'s ",(0,a.jsx)("span",{className:"orange-bold",children:"instance"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"raising-the-gameevent",children:"Raising the GameEvent"}),"\n",(0,a.jsx)(n.h4,{id:"method-1-using-unityevent-no-params",children:"Method 1: Using UnityEvent (No Params)"}),"\n",(0,a.jsxs)(n.p,{children:["What is this ",(0,a.jsx)(n.em,{children:"other"})," script who can call ",(0,a.jsx)(n.code,{children:"OnGameRestart.Raise()"}),"? One possible candidate is the ",(0,a.jsx)(n.code,{children:"RestartButtonController"}),". We can have a following script that leverages on UnityEvent:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cs",metastring:'title="RestartButtonController.cs"',children:"\n    public UnityEvent gameRestart;\n\n    void ButtonClick()\n    {\n        gameRestart.Invoke();\n    }\n\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Attach this to the restart Button, and set ",(0,a.jsx)(n.code,{children:"ButtonClick()"})," as the callback of the button component. Then link ",(0,a.jsx)(n.code,{children:"OnGameRestart"})," SimpleGameEvent SO as ",(0,a.jsx)(n.code,{children:"gameRestart"})," UnityEvent that is invoked by clicking the restart button."]}),"\n",(0,a.jsx)(r.A,{path:t(1572).A,widthPercentage:"100%"}),"\n",(0,a.jsxs)(n.p,{children:["Basically in the Inspector, you drag in your ",(0,a.jsx)(n.code,{children:"SimpleGameEvent"})," ScriptableObject instance (e.g. ",(0,a.jsx)(n.code,{children:"OnGameRestart"}),"):"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Then you hook up ",(0,a.jsx)(n.code,{children:"SimpleGameEvent.Raise"})," to be called."]}),"\n",(0,a.jsxs)(n.li,{children:["Since SimpleGameEvent inherits from ",(0,a.jsx)(n.code,{children:"GameEvent<Object>"}),", its ",(0,a.jsx)(n.code,{children:"Raise(Object data)"})," method needs an argument."]}),"\n",(0,a.jsxs)(n.li,{children:["UnityEvents can\u2019t supply null automatically, so you usually either:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Set the argument in the inspector (often just ",(0,a.jsx)(n.code,{children:"None"})," if you don\u2019t care), or"]}),"\n",(0,a.jsxs)(n.li,{children:["Make a ",(0,a.jsx)(n.code,{children:"Raise()"})," overload in ",(0,a.jsx)(n.code,{children:"SimpleGameEvent"})," that ignores data and just raises with null."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Now you can make Mario and Goomba GameObject to do the same: attach a SimpleGameEvent script to both gameObjects, with ",(0,a.jsx)(n.code,{children:"events"})," field referring to SO ",(0,a.jsx)(n.code,{children:"OnGameRestart"})," and a ",(0,a.jsx)(n.code,{children:"GameRestart()"})," callback in each of its controller as follows. The video below also shows that each gameObject (e.g: Mario) can contain multiple ",(0,a.jsx)(n.code,{children:"GameEventListeners"})," so that you can register various callbacks from any script in that gameObject."]}),"\n",(0,a.jsx)(o.A,{path:"https://50033.s3.ap-southeast-1.amazonaws.com/week-5/game-restart.mp4",widthPercentage:"100%"}),"\n",(0,a.jsx)("br",{}),"\n",(0,a.jsx)(n.h4,{id:"method-2-direct-reference-approach",children:"Method 2: Direct Reference Approach"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-cs",metastring:'title="PlayerController.cs"',children:'public GameEvent<Object> onDamagePlayer;\n\n  void OnTriggerEnter2D(Collider2D other)\n  {\n      if (other.gameObject.CompareTag("Player"))\n      {\n          onDamagePlayer.Raise();\n      }\n  }\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Here you hold a direct reference to the ",(0,a.jsx)(n.code,{children:"GameEvent<Object>"})," asset (in the inspector you assign the ",(0,a.jsx)(n.code,{children:"OnDamagePlayer"})," SO)."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["You can now ",(0,a.jsx)(n.code,{children:"raise"})," it in code directly, passing arguments as the payload: in this case since ",(0,a.jsx)(n.code,{children:"onDamagePlayer"})," is an event of ",(0,a.jsx)(n.code,{children:"Void"})," type then we don't pass any arguments."]}),"\n",(0,a.jsxs)(n.li,{children:["Listeners get that reference in their callback.","\n",(0,a.jsx)("br",{}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"key-distinction",children:"Key Distinction"}),"\n",(0,a.jsxs)(n.p,{children:["Using ",(0,a.jsx)(n.code,{children:"UnityEvent"})," decouples code from the event system. The Button just says \u201cwhen clicked, call whatever I wired up in the inspector.\u201d You can assign ",(0,a.jsx)(n.code,{children:"SimpleGameEvent.Raise"})," with or without arguments. More designer-friendly."]}),"\n",(0,a.jsxs)(n.p,{children:["Using ",(0,a.jsx)(n.code,{children:"GameEvent"})," field in code results in ",(0,a.jsx)(n.strong,{children:"tighter"})," coupling. You\u2019re explicitly saying \u201cthis script raises this event.\u201d You can pass contextual data (this, some ScriptableObject, etc.) at runtime."]}),"\n",(0,a.jsxs)(n.admonition,{type:"note",children:[(0,a.jsxs)(n.p,{children:["Regardless of which method you choose, it is ",(0,a.jsx)("span",{className:"red-bold",children:"important"})," for you to be able to trace properly the chain of events that make this works. The following diagram illustrates what actually happened from the moment restart button is clicked to the moment all ",(0,a.jsx)(n.code,{children:"GameRestart()"})," functions in the scripts attached to Mario, Camera, and all Goombas are called:"]}),(0,a.jsx)(r.A,{path:t(56921).A,customClass:"invert-color",widthPercentage:"100%"})]}),"\n",(0,a.jsx)(n.h2,{id:"migrate",children:"Migrate"}),"\n",(0,a.jsx)(n.p,{children:"Now that you know how ScriptableObject Event System work, carefully migrate your entire project (all scenes) to adopt this new event system."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Delete ",(0,a.jsx)("span",{class:"orange-bold",children:"each"})," old ",(0,a.jsx)(n.code,{children:"GameManager.instance.[event].AddListener(CallbackMethod)"})," line, and replace it by attaching the corresponding ",(0,a.jsx)(n.code,{children:"GameEventListener"})," script to the GameObject"]}),"\n",(0,a.jsxs)(n.li,{children:["Ensure that you select the correct ",(0,a.jsx)(n.code,{children:"GameEventListener"})," type (no argument ",(0,a.jsx)(n.code,{children:"Void"}),", ",(0,a.jsx)(n.code,{children:"int"}),", or ",(0,a.jsx)(n.code,{children:"IPowerup"})," type argument)"]}),"\n",(0,a.jsxs)(n.li,{children:["Link up the right ",(0,a.jsx)(n.code,{children:"GameEvent"})," in the Inspector to match that ",(0,a.jsx)(n.code,{children:"[event]"})," you are replacing"]}),"\n",(0,a.jsxs)(n.li,{children:["Link up ",(0,a.jsx)(n.code,{children:"CallbackMethod"})," at the ",(0,a.jsx)(n.code,{children:"GameEventListener"})," Inspector. Make sure that this method is ",(0,a.jsx)("span",{className:"orange-bold",children:"public"})]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["After a few tries, the procedure should be quite standard. Firstly, create the ",(0,a.jsx)(n.code,{children:"GameEvent"}),"s."]}),"\n",(0,a.jsxs)(n.p,{children:["Secondly, figure out which callback methods should be run for each event. Create a ",(0,a.jsx)(n.code,{children:"public"})," callback method where you will handle a particular event in a script. Then, on the same gameObject where that script is attached to, add a ",(0,a.jsx)(n.code,{children:"GameEventListener"})," script with that ",(0,a.jsx)(n.code,{children:"public"})," method as the ",(0,a.jsx)(n.code,{children:"Response"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["Thirdly, figure out which scripts shall ",(0,a.jsx)(n.code,{children:"Raise"})," the events. To ",(0,a.jsx)(n.code,{children:"Raise"})," a ",(0,a.jsx)(n.code,{children:"GameEvent"}),", attach that ",(0,a.jsx)(n.code,{children:"GameEvent"})," ",(0,a.jsx)(n.code,{children:"Raise"})," method as a listener to ",(0,a.jsx)(n.code,{children:"public UnityEvent event"})," member in that script that wants to ",(0,a.jsx)(n.em,{children:"cast"})," (raise) it, for as written in the ",(0,a.jsx)(n.code,{children:"RestartButtonController"})," above."]}),"\n",(0,a.jsx)(n.p,{children:"Here's a quick video for your reference:"}),"\n",(0,a.jsx)(o.A,{path:"https://50033.s3.ap-southeast-1.amazonaws.com/week-5/migrate.mp4",widthPercentage:"100%"}),"\n",(0,a.jsx)(n.admonition,{title:"For reference only",type:"caution",children:(0,a.jsx)(n.p,{children:"Your actual implementation might differ and that's alright, so don't be alarmed. As long as the game works as intended with this new architecture, that's fine."})}),"\n",(0,a.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsxs)(n.p,{children:["A ",(0,a.jsx)(n.code,{children:"UnityEvent"})," field on a ",(0,a.jsx)(n.code,{children:"MonoBehaviour"})," is basically a container of listeners stored in that component instance. When the component is destroyed or disabled, that \u201ccontainer\u201d (and all the registered listeners) goes away with it."]}),"\n",(0,a.jsxs)(n.p,{children:["On the other hand, the ",(0,a.jsx)(n.code,{children:"GameEvent<T>"})," ScriptableObject is a ",(0,a.jsx)(n.strong,{children:"shared"})," event channel asset."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Listeners live inside the channel asset that ",(0,a.jsx)(n.em,{children:"all"})," scenes can share"]}),"\n",(0,a.jsx)(n.li,{children:"The event channel asset persists across scenes and can be reused anywhere"}),"\n"]}),"\n",(0,a.jsx)(n.admonition,{title:"Learning Point",type:"success",children:(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"UnityEvent"}),": ",(0,a.jsx)(n.em,{children:"listeners live inside the scene instance"}),"\n",(0,a.jsx)(n.strong,{children:"ScriptableObject GameEvent"}),": ",(0,a.jsx)(n.em,{children:"listeners live inside the channel asset that all scenes can share"})]})})]})}function g(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(m,{...e})}):m(e)}},56921:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/gamerestart-soga-74421533f7fac78d8f02f4af76381ddd.png"},32467:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/2023-09-22-16-16-26-cafd61a7520077a674700d8393e73e05.png"},1572:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/2023-09-22-16-25-30-198f5f511382d72651bf58dd48bb99db.png"},5988:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/2025-10-02-09-17-51-c1f1f72a10bcbc05224d1b80e099dd29.png"},69122:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/singleton-archi-c1928ec9c01c579f99d96d2739e5a948.png"},11716:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/soga-arch-471ecb0548cfa55af568d60f8e0d8a1a.png"}}]);