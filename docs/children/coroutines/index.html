<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-children/coroutines" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Polishing with Coroutines | Game Development and Design</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://natalieagus.github.io/50033/docs/children/coroutines"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Polishing with Coroutines | Game Development and Design"><meta data-rh="true" name="description" content="To polish our game further, we need to ensure that:"><meta data-rh="true" property="og:description" content="To polish our game further, we need to ensure that:"><link data-rh="true" rel="icon" href="/50033/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://natalieagus.github.io/50033/docs/children/coroutines"><link data-rh="true" rel="alternate" href="https://natalieagus.github.io/50033/docs/children/coroutines" hreflang="en"><link data-rh="true" rel="alternate" href="https://natalieagus.github.io/50033/docs/children/coroutines" hreflang="x-default"><script src="https://cdn.jsdelivr.net/npm/brython@3.9.5/brython.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/brython@3.9.5/brython_stdlib.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/50033/assets/css/styles.9cdf0fa5.css">
<script src="/50033/assets/js/runtime~main.c50217e7.js" defer="defer"></script>
<script src="/50033/assets/js/main.f08ea8f3.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/50033/img/home-logo.svg"><link rel="preload" as="image" href="/50033/assets/images/2023-09-15-11-49-56-46a9b4c24e7164bb369cf0a28d5af5be.png"><link rel="preload" as="image" href="/50033/assets/images/2023-09-15-17-59-59-21283c50f10d6340181c8c8f33786474.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_jvwV"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/50033/"><div class="navbar__logo"><img src="/50033/img/home-logo.svg" alt="DDW Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/50033/img/home-logo.svg" alt="DDW Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">50.033</b></a><a class="navbar__item navbar__link" href="/50033/about/intro">About</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/50033/docs/syllabus">Lab Docs</a><a class="navbar__item navbar__link" href="/50033/resources/category/general-resources">Resources</a></div><div class="navbar__items navbar__items--right"><div class="searchBox_H2mL"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><a href="https://github.com/natalieagus/50033" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_eExm"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_RSuS"><div class="sidebarViewport_pYEE"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/50033/"><img src="/50033/img/home-logo.svg" alt="DDW Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/50033/img/home-logo.svg" alt="DDW Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"><b>50.033</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/50033/docs/syllabus">Syllabus</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/50033/docs/category/unity-for-newborns">Unity for Newborns</a><button aria-label="Expand sidebar category &#x27;Unity for Newborns&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/50033/docs/category/unity-for-babies">Unity for Babies</a><button aria-label="Expand sidebar category &#x27;Unity for Babies&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/50033/docs/category/unity-for-toddlers">Unity for Toddlers</a><button aria-label="Expand sidebar category &#x27;Unity for Toddlers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/50033/docs/category/unity-for-children">Unity for Children</a><button aria-label="Collapse sidebar category &#x27;Unity for Children&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/50033/docs/children/singletons">The Singleton Pattern</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/50033/docs/children/static">C# Quick Tour</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/50033/docs/children/scriptableobjects">Scriptable Objects</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/50033/docs/children/coroutines">Polishing with Coroutines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/50033/docs/children/building">Building Your Game</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/50033/docs/children/checkoff">Checkoff</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/50033/docs/category/unity-for-teens">Unity for Teens</a><button aria-label="Expand sidebar category &#x27;Unity for Teens&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/50033/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/50033/docs/category/unity-for-children"><span itemprop="name">Unity for Children</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Polishing with Coroutines</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Polishing with Coroutines</h1></header>
<p>To polish our game further, we need to ensure that:</p>
<ol>
<li>All player actions have discernible <strong>feedback</strong></li>
<li>The UI is coherent</li>
<li>There exist a main menu to properly start a game</li>
<li>Restart and pausing capability works as intended</li>
<li>There exist some modularity in the code structure of the game, for instance: powerups</li>
</ol>
<p>What we have learned so far: animation, sound management, input system, scriptable objects, singleton pattern, and asset management are more than sufficient to polish the game. But another aspect of polishing that we want to have in our game is <span class="orange-bold">responsiveness</span>.</p>
<p>In certain situations, we might want to spread a sequence of events like procedural animations over time. We can utilise <strong>coroutines</strong> for this.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="c-coroutines">C#: Coroutines<a href="#c-coroutines" class="hash-link" aria-label="Direct link to C#: Coroutines" title="Direct link to C#: Coroutines">​</a></h2>
<p>A coroutine lets us spread tasks across several <strong>frames</strong>. It pauses execution and return control to Unity, and then continue where it left off on the following <span class="orange-bold">frame</span>. A normal function like <code>Update()</code> cannot do this and must run into completion before returning control to Unity.</p>
<p>Coroutines are very <span class="orange-bold">resource efficient</span> so it&#x27;s okay to use them for your projects.</p>
<div class="theme-admonition theme-admonition-warning alert alert--danger admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_vXIg"><p>It is important to understand that Coroutines are <span class="orange-bold">not</span> threads. Synchronous operations that run within coroutines are still executed on Unity main thread. Do <span class="orange-bold">not</span> use blocking operation in a coroutine. If you want to use threads for consuming an <code>HTTP</code> request, for example, you can use <a href="#async-methods">async methods</a> instead.</p></div></div>
<p>You can declare and call Coroutine like this:</p>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token return-type class-name">IEnumerator</span><span class="token plain">  </span><span class="token function" style="color:#9a86fd">functionName</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// implementation here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// typically contain a yield return statement</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token return-type class-name keyword" style="color:#ffcc99">void</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">UseCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// call it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token function" style="color:#9a86fd">StartCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token function" style="color:#9a86fd">functionName</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// do other things (can be done immediately after coroutine yields)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="basic-idea">Basic Idea<a href="#basic-idea" class="hash-link" aria-label="Direct link to Basic Idea" title="Direct link to Basic Idea">​</a></h4>
<p>When you start a coroutine using <code>StartCoroutine</code>, the coroutine runs on the Unity main thread, just like the rest of your game code. It <span class="orange-bold">doesn&#x27;t block</span> the execution of the <code>Update</code> or other functions in your script. You also <span class="orange-bold">don&#x27;t need to wait for the coroutine to finish</span> before the Update function or other Unity event functions are called as per normal.</p>
<p>The Unity main thread continues to execute other code and events while the coroutine is running in the background. The coroutine itself will <code>yield</code> control back to the main thread when it encounters a <code>yield</code> statement, such as yield return new <code>WaitForSecondsRealtime(time)</code> (see later section), allowing other code to run during the specified time delay <span class="orange-bold">without freezing</span> the entire game. Once the time delay is over, the coroutine resumes its execution.</p>
<p>In short, you can think of coroutines in Unity as a way to perform tasks over time or in the background without blocking the main thread and the normal execution of Unity&#x27;s event functions like <code>Update</code>.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="examples">Examples<a href="#examples" class="hash-link" aria-label="Direct link to Examples" title="Direct link to Examples">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="health-replenish-ui">Health Replenish UI<a href="#health-replenish-ui" class="hash-link" aria-label="Direct link to Health Replenish UI" title="Direct link to Health Replenish UI">​</a></h4>
<p>One example of procedural animation is gradually increasing the health bar over time (e.g: after drinking a potion, etc):</p>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockTitle_Ktv7">HealthBar.cs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">.</span><span class="token namespace" style="opacity:0.7">Collections</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">UnityEngine</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">public</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">class</span><span class="token plain"> </span><span class="token class-name">HealthBar</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token type-list class-name">MonoBehaviour</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">   </span><span class="token comment" style="color:#6c6783">// an SO instance containing hp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">   </span><span class="token keyword" style="color:#ffcc99">public</span><span class="token plain"> </span><span class="token class-name">IntVariable</span><span class="token plain"> playerHP</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">   </span><span class="token keyword" style="color:#ffcc99">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#ffcc99">void</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">RefillHealth</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token class-name keyword" style="color:#ffcc99">int</span><span class="token plain"> amount</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">   </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">       </span><span class="token function" style="color:#9a86fd">StartCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token function" style="color:#9a86fd">HealthIncrease</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">   </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">   </span><span class="token return-type class-name">IEnumerator</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">HealthIncrease</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token class-name keyword" style="color:#ffcc99">float</span><span class="token plain"> amount</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">       </span><span class="token keyword" style="color:#ffcc99">for</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token class-name keyword" style="color:#ffcc99">int</span><span class="token plain"> x</span><span class="token operator" style="color:#e09142">=</span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> x </span><span class="token operator" style="color:#e09142">&lt;=</span><span class="token plain"> amount </span><span class="token operator" style="color:#e09142">&amp;&amp;</span><span class="token plain"> playerHP</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">Value </span><span class="token operator" style="color:#e09142">&lt;=</span><span class="token plain"> playerHP</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">maxValue </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> x</span><span class="token operator" style="color:#e09142">++</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">           playerHP</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">Value </span><span class="token operator" style="color:#e09142">+=</span><span class="token plain"> x</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">           GameManager</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">instance</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">UpdateUI</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// calls for update</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">           </span><span class="token keyword" style="color:#ffcc99">yield</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">return</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">WaitForSeconds</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">0.2f</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">       </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">   </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="temporary-invincibility">Temporary Invincibility<a href="#temporary-invincibility" class="hash-link" aria-label="Direct link to Temporary Invincibility" title="Direct link to Temporary Invincibility">​</a></h4>
<p>For those making casual (chaotic) couch multiplayer game, you will also want to use coroutines to prevent the same player to be hit again before 0.5 seconds has passed. This will create temporary invincibility to avoid an unjust game experience. We would deactivate the player&#x27;s hitbox or some <code>vulnerable</code> state for 0.5 seconds before enabling it again.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="fading-loading-screen">Fading Loading Screen<a href="#fading-loading-screen" class="hash-link" aria-label="Direct link to Fading Loading Screen" title="Direct link to Fading Loading Screen">​</a></h4>
<p>Another example is to fade UI elements in the loading scene right before game starts:</p>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockTitle_Ktv7">LoadAndWait.cs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">UnityEngine</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">UnityEngine</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">.</span><span class="token namespace" style="opacity:0.7">SceneManagement</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">public</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">class</span><span class="token plain"> </span><span class="token class-name">LoadAndWait</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token type-list class-name">MonoBehaviour</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token keyword" style="color:#ffcc99">public</span><span class="token plain"> </span><span class="token class-name">CanvasGroup</span><span class="token plain"> c</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token return-type class-name keyword" style="color:#ffcc99">void</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">Start</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token function" style="color:#9a86fd">StartCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token function" style="color:#9a86fd">Fade</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token return-type class-name">IEnumerator</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">Fade</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token keyword" style="color:#ffcc99">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token class-name keyword" style="color:#ffcc99">float</span><span class="token plain"> alpha </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1f</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> alpha </span><span class="token operator" style="color:#e09142">&gt;=</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">-</span><span class="token number" style="color:#e09142">0.05f</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> alpha </span><span class="token operator" style="color:#e09142">-=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0.05f</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            c</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">alpha </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> alpha</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token keyword" style="color:#ffcc99">yield</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">return</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">WaitForSecondsRealtime</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">0.1f</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// once done, go to next scene</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        SceneManager</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">LoadSceneAsync</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;World-1-1&quot;</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> LoadSceneMode</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">Single</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token keyword" style="color:#ffcc99">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#ffcc99">void</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">ReturnToMain</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// TODO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Return to main menu&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We can tryout <code>Fade</code> above by creating another scene called <code>LoadingScene</code> with the following configuration. Feel free to create a Main Menu as well.</p>
<div class="center_div_ipNX"><video style="width:100%" class="center_video_QRNx" controls=""><source src="https://50033.s3.ap-southeast-1.amazonaws.com/week-4/fadescene.mp4" type="video/mp4">Your browser does not support the video tag.</video></div>
<div class="theme-admonition theme-admonition-note alert alert--secondary admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>highlight on hover button</div><div class="admonitionContent_vXIg"><p>It&#x27;s common to highlight a button by showing some image beside it, like the mushroom cursor on SuperMarioBros main menu. To do this, simply set the <code>Normal Color</code> of a button to have an alpha value of 0, and its <code>Highlighted Color</code> to have an alpha value of 1.</p><div class="center_div_ipNX"><video style="width:100%" class="center_video_QRNx" controls=""><source src="https://50033.s3.ap-southeast-1.amazonaws.com/week-4/hover-highlight-button.mp4" type="video/mp4">Your browser does not support the video tag.</video></div><p>When you select a button on the UI, the button will remain &quot;selected&quot; even after you have finished clicking. In order to &quot;reset&quot; the button state, add the following instructions in the callback of that button (e.g: we want to reset highscore but not leave the button in the state of &quot;pressed&quot; after highscore is reset):</p><div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token class-name">GameObject</span><span class="token plain"> eventSystem </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> GameObject</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Find</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;EventSystem&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        eventSystem</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token generic-method function" style="color:#9a86fd">GetComponent</span><span class="token generic-method generic class-name punctuation" style="color:#6c6783">&lt;</span><span class="token generic-method generic class-name">UnityEngine</span><span class="token generic-method generic class-name punctuation" style="color:#6c6783">.</span><span class="token generic-method generic class-name">EventSystems</span><span class="token generic-method generic class-name punctuation" style="color:#6c6783">.</span><span class="token generic-method generic class-name">EventSystem</span><span class="token generic-method generic class-name punctuation" style="color:#6c6783">&gt;</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">SetSelectedGameObject</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#ffcc99">null</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is what the <code>EventSystem</code> GameObject in your scene is for, which is to manage events of mouse clicks and keyboard presses to interact with the UI elements (automatically created when you added your first UI Element GameObject to your scene).</p></div></div>
<br>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="yield-return"><code>yield return</code><a href="#yield-return" class="hash-link" aria-label="Direct link to yield-return" title="Direct link to yield-return">​</a></h3>
<p>On a coroutine, the yield return <code>[something]</code> returns control to Unity until that <code>[something]</code> condition is fulfilled. If we do <code>yield return null</code>, your coroutine execution <span class="orange-bold">pauses</span> for the next frame and <strong>continues</strong> where it left off (after the <code>yield return</code>) afterwards, depending on whether that <code>[something]</code> condition is fulfilled, <span class="orange-bold">all these done without blocking the caller of the coroutine</span>. That <code>[something]</code> can be also be any of the things below:</p>
<ol>
<li><a href="https://docs.unity3d.com/ScriptReference/WaitForSeconds.html" target="_blank" rel="noopener noreferrer">Wait for a few seconds</a> (scaled): <code>yield return new WaitForSeconds(0.1f)</code></li>
<li>Wait for a few seconds (<a href="https://docs.unity3d.com/ScriptReference/WaitForSecondsRealtime.html" target="_blank" rel="noopener noreferrer">realtime</a>): <code>yield return new WaitForSecondsRealtime(0.1f)</code></li>
<li>Wait until <a href="https://docs.unity3d.com/ScriptReference/WaitForFixedUpdate.html" target="_blank" rel="noopener noreferrer">next fixed update frame</a> or <a href="https://docs.unity3d.com/ScriptReference/WaitForEndOfFrame.html" target="_blank" rel="noopener noreferrer">until end of frame</a>:<!-- -->
<ul>
<li><code>yield return new WaitForEndOfFrame()</code></li>
<li><code>yield return new WaitForFixedUpdate()</code></li>
</ul>
</li>
<li>Wait until a certain <em>delegate</em> value is <a href="https://docs.unity3d.com/ScriptReference/WaitUntil.html" target="_blank" rel="noopener noreferrer">true</a> or <a href="https://docs.unity3d.com/ScriptReference/WaitWhile.html" target="_blank" rel="noopener noreferrer">false</a>
<ul>
<li><code>yield return new WaitUntil(() =&gt; some_value &gt; some_condition)</code></li>
<li><code>yield return new WaitWhile(() =&gt; some_value &lt; some_condition)</code></li>
</ul>
</li>
</ol>
<p>The example below illustrates the behavior using <code>WaitForSecondsRealtime</code>:</p>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">.</span><span class="token namespace" style="opacity:0.7">Collections</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">UnityEngine</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">public</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">class</span><span class="token plain"> </span><span class="token class-name">Coroutines</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token type-list class-name">MonoBehaviour</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">   </span><span class="token return-type class-name keyword" style="color:#ffcc99">void</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">Start</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">       Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Begin Start event&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">       </span><span class="token function" style="color:#9a86fd">StartCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token function" style="color:#9a86fd">WaitCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">2f</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">       Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;End Start event&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">   </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">   </span><span class="token keyword" style="color:#ffcc99">private</span><span class="token plain"> </span><span class="token return-type class-name">IEnumerator</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">WaitCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token class-name keyword" style="color:#ffcc99">float</span><span class="token plain"> time</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">       Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Inside coroutine&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">       </span><span class="token keyword" style="color:#ffcc99">yield</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">return</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">WaitForSecondsRealtime</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">time</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">       Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Finish coroutine after &quot;</span><span class="token operator" style="color:#e09142">+</span><span class="token plain">time</span><span class="token operator" style="color:#e09142">+</span><span class="token string" style="color:#ffcc99">&quot; seconds&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">   </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// Printed output:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#6c6783">//</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// Begin Start event</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// Inside coroutine</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// End Start event</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// Finish coroutine after 2 seconds</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The order of execution of the code at first begin as per normal: line 8, 9, then line 14, and 15. When <code>yield return</code> statement is met, we return control to Unity first (hence line 10 is executed). Two seconds later, line 16 is then executed.</p>
<p>Here&#x27;s another example using <code>WaitWhile</code> (taken from <a href="https://docs.unity3d.com/ScriptReference/WaitWhile.html" target="_blank" rel="noopener noreferrer">Unity official documentation</a>):</p>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">UnityEngine</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">.</span><span class="token namespace" style="opacity:0.7">Collections</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">public</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">class</span><span class="token plain"> </span><span class="token class-name">WaitWhileExample</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token type-list class-name">MonoBehaviour</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#ffcc99">public</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#ffcc99">int</span><span class="token plain"> enemies </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">10</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// we assume something else is reducing this value, one per second</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token return-type class-name keyword" style="color:#ffcc99">void</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">Start</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Begin rescue mission&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token function" style="color:#9a86fd">StartCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token function" style="color:#9a86fd">Rescue</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Toad&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Rescue mission started&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token return-type class-name">IEnumerator</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">Rescue</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token class-name keyword" style="color:#ffcc99">string</span><span class="token plain"> name</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token interpolation-string string" style="color:#ffcc99">$&quot;Waiting for Mario to rescue </span><span class="token interpolation-string interpolation punctuation" style="color:#6c6783">{</span><span class="token interpolation-string interpolation expression language-csharp">name</span><span class="token interpolation-string interpolation punctuation" style="color:#6c6783">}</span><span class="token interpolation-string string" style="color:#ffcc99">...&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#ffcc99">yield</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">return</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">WaitWhile</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=&gt;</span><span class="token plain"> enemies </span><span class="token operator" style="color:#e09142">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token interpolation-string string" style="color:#ffcc99">$&quot;Finally, all enemies are eliminated and </span><span class="token interpolation-string interpolation punctuation" style="color:#6c6783">{</span><span class="token interpolation-string interpolation expression language-csharp">name</span><span class="token interpolation-string interpolation punctuation" style="color:#6c6783">}</span><span class="token interpolation-string string" style="color:#ffcc99"> have been rescued!&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// Printed output:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#6c6783">//</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// Begin rescue mission</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// Waiting for Mario to rescue Toad...</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// Rescue mission started</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// Finally, all enemies are eliminated and I have been rescued!</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-important alert alert--info admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_vXIg"><p>When you start a coroutine using <code>StartCoroutine</code>, it doesn&#x27;t block the execution of the calling method (in the above case, <code>Start</code>). The coroutine runs <em>separately</em> in the background, and the calling method continues to execute immediately after starting the coroutine.</p><p>Remember that Unity coroutines are not executed on separate threads. They run on the Unity main thread, just like the rest of your Unity game code. Coroutine provides a way to perform asynchronous-like operations <span class="orange-bold">without</span> introducing threading complexities.</p></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="waiting-for-a-coroutine-to-finish">Waiting for a Coroutine to Finish<a href="#waiting-for-a-coroutine-to-finish" class="hash-link" aria-label="Direct link to Waiting for a Coroutine to Finish" title="Direct link to Waiting for a Coroutine to Finish">​</a></h4>
<p>If you have a very specific case such as to wait for Coroutine launched in a <code>Start</code> function <em>before</em> the <code>Update</code> function is launched, then you need to use some kind of <code>flag</code> to make this happen, for instance:</p>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">.</span><span class="token namespace" style="opacity:0.7">Collections</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">UnityEngine</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">public</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">class</span><span class="token plain"> </span><span class="token class-name">SomeScript</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token type-list class-name">MonoBehaviour</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token keyword" style="color:#ffcc99">private</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#ffcc99">bool</span><span class="token plain"> isStartComplete </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ffcc99">false</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token return-type class-name keyword" style="color:#ffcc99">void</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">Start</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Begin Start event&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token function" style="color:#9a86fd">StartCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token function" style="color:#9a86fd">StartEventCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Start Invoked&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token keyword" style="color:#ffcc99">private</span><span class="token plain"> </span><span class="token return-type class-name">IEnumerator</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">StartEventCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// Perform any initialization or tasks you need in Start here.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// Assume you want to delay for 2 seconds before Update() works</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token keyword" style="color:#ffcc99">yield</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">return</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">WaitForSeconds</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">2f</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// Mark the Start as complete.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        isStartComplete </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ffcc99">true</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token return-type class-name keyword" style="color:#ffcc99">void</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">Update</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// Only execute Update when StartEventCoroutine completes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token keyword" style="color:#ffcc99">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">isStartComplete</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token comment" style="color:#6c6783">// Your Update code here.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token comment" style="color:#6c6783">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="starting-multiple-coroutines">Starting Multiple Coroutines<a href="#starting-multiple-coroutines" class="hash-link" aria-label="Direct link to Starting Multiple Coroutines" title="Direct link to Starting Multiple Coroutines">​</a></h3>
<p>You can also start many coroutines at once, such as:</p>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token return-type class-name keyword" style="color:#ffcc99">void</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">Start</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Begin rescue mission&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token function" style="color:#9a86fd">StartCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token function" style="color:#9a86fd">Rescue</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Toad&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token function" style="color:#9a86fd">StartCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token function" style="color:#9a86fd">Rescue</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Peach&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Rescue mission started&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output:</p>
<section><img src="/50033/assets/images/2023-09-15-11-49-56-46a9b4c24e7164bb369cf0a28d5af5be.png" class="center_image_tcFY" style="width:100%"></section>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="stopping-coroutines">Stopping Coroutines<a href="#stopping-coroutines" class="hash-link" aria-label="Direct link to Stopping Coroutines" title="Direct link to Stopping Coroutines">​</a></h3>
<p>You can stop any coroutines by using the <code>StopCoroutine</code> method. There are three ways to do so: with the name of the <code>IEnumerator</code> as string put as the parameter, <em>or</em> the reference to the coroutine, <em>or</em> the Coroutine created during <code>StartCoroutine</code>. The method you choose should match how you started the Coroutine.</p>
<ul>
<li>If a string is used as the argument in <code>StartCoroutine</code>, use the string in <code>StopCoroutine</code>. This method only works for coroutines with <span class="orange-bold">no parameters</span></li>
<li>If you use the IEnumerator in <code>StartCoroutine</code>, use its reference too in <code>StopCoroutine</code>.</li>
<li>Alternatively, you can use <code>StopCoroutine</code> with the Coroutine used for creation.</li>
</ul>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token comment" style="color:#6c6783">// Method 1 (string)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token function" style="color:#9a86fd">StartCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Fade&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token function" style="color:#9a86fd">StopCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Fade&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// Method 2 (using reference to the IEnumerator)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">private</span><span class="token plain"> </span><span class="token class-name">IEnumerator</span><span class="token plain"> coroutine</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">coroutine </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">Rescue</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Toad&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token function" style="color:#9a86fd">StopCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">coroutine</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token comment" style="color:#6c6783">// Method 3 (using the Coroutine)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token class-name">Coroutine</span><span class="token plain"> RescueToad </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">StartCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Rescue&quot;</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token string" style="color:#ffcc99">&quot;Toad&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token function" style="color:#9a86fd">StopCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">RescueToad</span><span class="token punctuation" style="color:#6c6783">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note alert alert--secondary admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_vXIg"><p>A coroutine will also <span class="orange-bold">automatically</span> stop if the object that it’s attached to is disabled by SetActive(false) or by destroying the object with Destroy().</p></div></div>
<p>If you would like to <span class="orange-bold">stop all Coroutines in the Behavior</span> (Coroutines on the script), then you can use the method <code>StopAllCoroutines()</code>. Note that this will only stop coroutines that are in the same script so other scripts won&#x27;t be effected.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="async-methods">C#: Async Methods and Multithreading With Task<a href="#async-methods" class="hash-link" aria-label="Direct link to C#: Async Methods and Multithreading With Task" title="Direct link to C#: Async Methods and Multithreading With Task">​</a></h2>
<div class="theme-admonition theme-admonition-warning alert alert--danger admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_vXIg"><p>It is highly unlikely that you will need to implement async methods with extra threads in your game, but this section is added here to highlight <em>differences</em> between async methods and coroutines.</p><p>Unity&#x27;s coroutines and C#&#x27;s async methods are <span class="orange-bold">separate</span> mechanisms for handling asynchronous operations. Unity&#x27;s coroutines are specific to the Unity game engine and provide a way to perform tasks over time or in the background without blocking the main thread. C#&#x27;s async/await feature, on the other hand, is a <strong>general-purpose</strong> mechanism for handling asynchronous operations in C#.</p></div></div>
<p>Async methods running on a separate threads are useful <strong>if</strong> you need to perform <span class="orange-bold">very extensive computation</span> that requires millions of CPU cycles while keeping your game responsive. In other words, we want to utilise the CPU <em>only after it&#x27;s done</em> computing whatever it needs for each frame.</p>
<p>Consider the following script. Here we test <strong>three</strong> different approach to perform an expensive <code>PerlinNoise</code> computation: the vanilla way (just sequential), using a coroutine, and using another thread (<code>Task</code>) asynchronously. When key <code>c</code> is pressed, this heavy computation will begin.</p>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockTitle_Ktv7">HeavyComputation.cs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">.</span><span class="token namespace" style="opacity:0.7">Collections</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">UnityEngine</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">.</span><span class="token namespace" style="opacity:0.7">Threading</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">.</span><span class="token namespace" style="opacity:0.7">Threading</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">.</span><span class="token namespace" style="opacity:0.7">Tasks</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">public</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">enum</span><span class="token plain"> </span><span class="token class-name">method</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    useVanilla </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    useCoroutine </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    useAsync </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">public</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">class</span><span class="token plain"> </span><span class="token class-name">AsyncAwaitTest</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token type-list class-name">MonoBehaviour</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token keyword" style="color:#ffcc99">public</span><span class="token plain"> </span><span class="token class-name">method</span><span class="token plain"> method</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token keyword" style="color:#ffcc99">public</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#ffcc99">int</span><span class="token plain"> size </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">10000</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token keyword" style="color:#ffcc99">private</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#ffcc99">bool</span><span class="token plain"> calculationState </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ffcc99">false</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token return-type class-name keyword" style="color:#ffcc99">void</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">Update</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token keyword" style="color:#ffcc99">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">Input</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">GetKeyDown</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;c&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Key c is pressed&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token keyword" style="color:#ffcc99">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token operator" style="color:#e09142">!</span><span class="token plain">calculationState</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                </span><span class="token keyword" style="color:#ffcc99">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">method</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                    </span><span class="token keyword" style="color:#ffcc99">case</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">method</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">useVanilla</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                        </span><span class="token function" style="color:#9a86fd">PerformCalculationsVanilla</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                        </span><span class="token keyword" style="color:#ffcc99">break</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                    </span><span class="token keyword" style="color:#ffcc99">case</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">method</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">useCoroutine</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                        </span><span class="token function" style="color:#9a86fd">StartCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token function" style="color:#9a86fd">PerformCalculationsCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                        </span><span class="token keyword" style="color:#ffcc99">break</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                    </span><span class="token keyword" style="color:#ffcc99">case</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">method</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">useAsync</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                        </span><span class="token function" style="color:#9a86fd">PerformCalculationsAsync</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                        </span><span class="token keyword" style="color:#ffcc99">break</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                    </span><span class="token keyword" style="color:#ffcc99">default</span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                        </span><span class="token keyword" style="color:#ffcc99">break</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Perform calculations dispatch done&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token keyword" style="color:#ffcc99">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">Input</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">GetKeyDown</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;q&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token function" style="color:#9a86fd">Destroy</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token keyword" style="color:#ffcc99">this</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">gameObject</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token return-type class-name keyword" style="color:#ffcc99">void</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">PerformCalculationsVanilla</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token class-name">System</span><span class="token class-name punctuation" style="color:#6c6783">.</span><span class="token class-name">Diagnostics</span><span class="token class-name punctuation" style="color:#6c6783">.</span><span class="token class-name">Stopwatch</span><span class="token plain"> stopwatch </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">System</span><span class="token constructor-invocation class-name punctuation" style="color:#6c6783">.</span><span class="token constructor-invocation class-name">Diagnostics</span><span class="token constructor-invocation class-name punctuation" style="color:#6c6783">.</span><span class="token constructor-invocation class-name">Stopwatch</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        stopwatch</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Start</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        calculationState </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ffcc99">true</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token class-name keyword" style="color:#ffcc99">float</span><span class="token class-name punctuation" style="color:#6c6783">[</span><span class="token class-name punctuation" style="color:#6c6783">,</span><span class="token class-name punctuation" style="color:#6c6783">]</span><span class="token plain"> mapValues </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name keyword" style="color:#ffcc99">float</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">size</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token keyword" style="color:#ffcc99">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token class-name keyword" style="color:#ffcc99">int</span><span class="token plain"> x </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> x </span><span class="token operator" style="color:#e09142">&lt;</span><span class="token plain"> size</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> x</span><span class="token operator" style="color:#e09142">++</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token keyword" style="color:#ffcc99">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token class-name keyword" style="color:#ffcc99">int</span><span class="token plain"> y </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> y </span><span class="token operator" style="color:#e09142">&lt;</span><span class="token plain"> size</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> y</span><span class="token operator" style="color:#e09142">++</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                mapValues</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">x</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> Mathf</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">PerlinNoise</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">x </span><span class="token operator" style="color:#e09142">*</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0.01f</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> y </span><span class="token operator" style="color:#e09142">*</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0.01f</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        calculationState </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ffcc99">false</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        stopwatch</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Stop</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        UnityEngine</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Real time elapsed using vanilla method: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">stopwatch</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">Elapsed</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        stopwatch</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Reset</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token return-type class-name">IEnumerator</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">PerformCalculationsCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token class-name">System</span><span class="token class-name punctuation" style="color:#6c6783">.</span><span class="token class-name">Diagnostics</span><span class="token class-name punctuation" style="color:#6c6783">.</span><span class="token class-name">Stopwatch</span><span class="token plain"> stopwatch </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">System</span><span class="token constructor-invocation class-name punctuation" style="color:#6c6783">.</span><span class="token constructor-invocation class-name">Diagnostics</span><span class="token constructor-invocation class-name punctuation" style="color:#6c6783">.</span><span class="token constructor-invocation class-name">Stopwatch</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        stopwatch</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Start</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        calculationState </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ffcc99">true</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token class-name keyword" style="color:#ffcc99">float</span><span class="token class-name punctuation" style="color:#6c6783">[</span><span class="token class-name punctuation" style="color:#6c6783">,</span><span class="token class-name punctuation" style="color:#6c6783">]</span><span class="token plain"> mapValues </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name keyword" style="color:#ffcc99">float</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">size</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token keyword" style="color:#ffcc99">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token class-name keyword" style="color:#ffcc99">int</span><span class="token plain"> x </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> x </span><span class="token operator" style="color:#e09142">&lt;</span><span class="token plain"> size</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> x</span><span class="token operator" style="color:#e09142">++</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token keyword" style="color:#ffcc99">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token class-name keyword" style="color:#ffcc99">int</span><span class="token plain"> y </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> y </span><span class="token operator" style="color:#e09142">&lt;</span><span class="token plain"> size</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> y</span><span class="token operator" style="color:#e09142">++</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                mapValues</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">x</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> Mathf</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">PerlinNoise</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">x </span><span class="token operator" style="color:#e09142">*</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0.01f</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> y </span><span class="token operator" style="color:#e09142">*</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0.01f</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token keyword" style="color:#ffcc99">yield</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">return</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">null</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// takes super long, only called at 60 times a second</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        calculationState </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ffcc99">false</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        stopwatch</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Stop</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        UnityEngine</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Real time elapsed Coroutine: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">stopwatch</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">Elapsed</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        stopwatch</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Reset</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token keyword" style="color:#ffcc99">yield</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">return</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">null</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token keyword" style="color:#ffcc99">async</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#ffcc99">void</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">PerformCalculationsAsync</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token class-name">System</span><span class="token class-name punctuation" style="color:#6c6783">.</span><span class="token class-name">Diagnostics</span><span class="token class-name punctuation" style="color:#6c6783">.</span><span class="token class-name">Stopwatch</span><span class="token plain"> stopwatch </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">System</span><span class="token constructor-invocation class-name punctuation" style="color:#6c6783">.</span><span class="token constructor-invocation class-name">Diagnostics</span><span class="token constructor-invocation class-name punctuation" style="color:#6c6783">.</span><span class="token constructor-invocation class-name">Stopwatch</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        stopwatch</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Start</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token class-name keyword" style="color:#ffcc99">var</span><span class="token plain"> result </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">await</span><span class="token plain"> Task</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Run</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            calculationState </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ffcc99">true</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token class-name keyword" style="color:#ffcc99">float</span><span class="token class-name punctuation" style="color:#6c6783">[</span><span class="token class-name punctuation" style="color:#6c6783">,</span><span class="token class-name punctuation" style="color:#6c6783">]</span><span class="token plain"> mapValues </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name keyword" style="color:#ffcc99">float</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">size</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token keyword" style="color:#ffcc99">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token class-name keyword" style="color:#ffcc99">int</span><span class="token plain"> x </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> x </span><span class="token operator" style="color:#e09142">&lt;</span><span class="token plain"> size</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> x</span><span class="token operator" style="color:#e09142">++</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                </span><span class="token keyword" style="color:#ffcc99">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token class-name keyword" style="color:#ffcc99">int</span><span class="token plain"> y </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> y </span><span class="token operator" style="color:#e09142">&lt;</span><span class="token plain"> size</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> y</span><span class="token operator" style="color:#e09142">++</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                    mapValues</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">x</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> Mathf</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">PerlinNoise</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">x </span><span class="token operator" style="color:#e09142">*</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0.01f</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> y </span><span class="token operator" style="color:#e09142">*</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0.01f</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token keyword" style="color:#ffcc99">return</span><span class="token plain"> mapValues</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        calculationState </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ffcc99">false</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        stopwatch</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Stop</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        UnityEngine</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Real time elapsed using Async &amp; Await: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">stopwatch</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">Elapsed</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        stopwatch</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Reset</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this video below, we bind the mouse right button click and movement with camera rotation to demonstrate how each method differs.</p>
<div class="center_div_ipNX"><video style="width:100%" class="center_video_QRNx" controls=""><source src="https://50033.s3.ap-southeast-1.amazonaws.com/week-4/async-vs-coroutine.mp4" type="video/mp4">Your browser does not support the video tag.</video></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="vanilla-method">Vanilla Method<a href="#vanilla-method" class="hash-link" aria-label="Direct link to Vanilla Method" title="Direct link to Vanilla Method">​</a></h4>
<p>The vanilla method causes the game to be <span class="orange-bold">unresponsive</span> for about 2 seconds.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="coroutine">Coroutine<a href="#coroutine" class="hash-link" aria-label="Direct link to Coroutine" title="Direct link to Coroutine">​</a></h4>
<p>When the method is changed into using a Coroutine, the time taken to complete the computation becomes close to 17 seconds instead (too long!). This is because of the <code>yield</code> statement at each outer loop (means the next loop is only resumed at the next frame). When <code>x</code> is set to 1000 and the game is run at 60fps, it takes <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1000</mn><mn>60</mn></mfrac><mo>=</mo><mn>16.67</mn></mrow><annotation encoding="application/x-tex">\frac{1000}{60} = 16.67</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em"><span style="top:-2.655em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">60</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1000</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">16.67</span></span></span></span> seconds to complete just this computation. This is way too long of a wait even though the system stays responsive in the meantime.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="async--await-with-task">Async &amp; Await with Task<a href="#async--await-with-task" class="hash-link" aria-label="Direct link to Async &amp; Await with Task" title="Direct link to Async &amp; Await with Task">​</a></h4>
<p>What we wanted is to <strong>utilise</strong> our CPU as much as possible <em>while staying responsive</em>. To do so, we can run <code>async</code> function and await for Task completion. Remember that <code>Update</code> is only called 60 times a second (where we check for inputs, execute basic game logic, etc), so there’s plenty of leftover time that we can use to complete this calculation function. It still takes slightly more than 2 seconds to complete the computation. This shows that using <code>async</code> function does not (necessarily) make any computation time faster than the vanilla method, but in the meantime, the system is still <strong>responsive</strong>.</p>
<div class="theme-admonition theme-admonition-warning alert alert--danger admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_vXIg"><p>Calling an <code>async</code> function without any <code>await</code> in its body results in synchronous execution. We need to <code>await</code> some <code>Task</code> as shown in the example above, e.g: <code>var result = await Task.Run(()</code>.</p></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="comparison-with-coroutine">Comparison With Coroutine<a href="#comparison-with-coroutine" class="hash-link" aria-label="Direct link to Comparison With Coroutine" title="Direct link to Comparison With Coroutine">​</a></h2>
<p>This section briefly covers the comparison between the two. There’s no better or worse solution, and you can simply choose the solution that suits your project best. The content for this section is distilled from <a href="https://www.youtube.com/watch?v=7eKi6NKri6I" target="_blank" rel="noopener noreferrer">this</a> video.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="async-functions-always-complete">Async Functions Always Complete<a href="#async-functions-always-complete" class="hash-link" aria-label="Direct link to Async Functions Always Complete" title="Direct link to Async Functions Always Complete">​</a></h3>
<p>Async functions <span class="orange-bold">always</span> runs into completion because they continue to run even after the MonoBehavior is destroyed, while Coroutines are run <span class="orange-bold">on</span> the GameObject. Therefore, disabling the gameobject will cause any coroutine running on it to stop but <span class="orange-bold">doesn’t exit</span> naturally.</p>
<p>Consider the following script:</p>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockTitle_Ktv7">TestDestroy.cs showLineNumbers</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">.</span><span class="token namespace" style="opacity:0.7">Collections</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">UnityEngine</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">.</span><span class="token namespace" style="opacity:0.7">Threading</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">.</span><span class="token namespace" style="opacity:0.7">Tasks</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">public</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">class</span><span class="token plain"> </span><span class="token class-name">TestDestroy</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token type-list class-name">MonoBehaviour</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#ffcc99">async</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#ffcc99">void</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">Start</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token function" style="color:#9a86fd">StartCoroutine</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token function" style="color:#9a86fd">Sampletask</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token function" style="color:#9a86fd">SampleTaskAsync</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#ffcc99">await</span><span class="token plain"> Task</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Delay</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">1000</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token function" style="color:#9a86fd">Destroy</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">gameObject</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#ffcc99">async</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#ffcc99">void</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">SampleTaskAsync</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// This task will finish, even though it&#x27;s object is destroyed</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token interpolation-string string" style="color:#ffcc99">$&quot;Async Task Started for object </span><span class="token interpolation-string interpolation punctuation" style="color:#6c6783">{</span><span class="token interpolation-string interpolation expression language-csharp keyword" style="color:#ffcc99">this</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:#6c6783">.</span><span class="token interpolation-string interpolation expression language-csharp">gameObject</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:#6c6783">.</span><span class="token interpolation-string interpolation expression language-csharp">name</span><span class="token interpolation-string interpolation punctuation" style="color:#6c6783">}</span><span class="token interpolation-string string" style="color:#ffcc99">&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#ffcc99">await</span><span class="token plain"> Task</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Delay</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">5000</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token interpolation-string string" style="color:#ffcc99">$&quot;Async Task Ended for object </span><span class="token interpolation-string interpolation punctuation" style="color:#6c6783">{</span><span class="token interpolation-string interpolation expression language-csharp keyword" style="color:#ffcc99">this</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:#6c6783">.</span><span class="token interpolation-string interpolation expression language-csharp">gameObject</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:#6c6783">.</span><span class="token interpolation-string interpolation expression language-csharp">name</span><span class="token interpolation-string interpolation punctuation" style="color:#6c6783">}</span><span class="token interpolation-string string" style="color:#ffcc99">&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token return-type class-name">IEnumerator</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">Sampletask</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// This task won&#x27;t finish, it will be stopped as soon as the object is destroyed</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token interpolation-string string" style="color:#ffcc99">$&quot;Coroutine Started for object </span><span class="token interpolation-string interpolation punctuation" style="color:#6c6783">{</span><span class="token interpolation-string interpolation expression language-csharp keyword" style="color:#ffcc99">this</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:#6c6783">.</span><span class="token interpolation-string interpolation expression language-csharp">gameObject</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:#6c6783">.</span><span class="token interpolation-string interpolation expression language-csharp">name</span><span class="token interpolation-string interpolation punctuation" style="color:#6c6783">}</span><span class="token interpolation-string string" style="color:#ffcc99">&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#ffcc99">yield</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">return</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">WaitForSeconds</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">5</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token interpolation-string string" style="color:#ffcc99">$&quot;Coroutine Ended for object </span><span class="token interpolation-string interpolation punctuation" style="color:#6c6783">{</span><span class="token interpolation-string interpolation expression language-csharp keyword" style="color:#ffcc99">this</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:#6c6783">.</span><span class="token interpolation-string interpolation expression language-csharp">gameObject</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:#6c6783">.</span><span class="token interpolation-string interpolation expression language-csharp">name</span><span class="token interpolation-string interpolation punctuation" style="color:#6c6783">}</span><span class="token interpolation-string string" style="color:#ffcc99">&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#9a86fd"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Attaching the above script and running it will result in the output:</p>
<div class="center_div_ipNX"><video style="width:100%" class="center_video_QRNx" controls=""><source src="https://50033.s3.ap-southeast-1.amazonaws.com/week-4/test-destroy-async.mp4" type="video/mp4">Your browser does not support the video tag.</video></div>
<p>Notice how the message <code>Coroutine Ended...</code> never gets printed out, but instruction at line 19 causes an error because we tried to access the already destroyed GameObject&#x27;s name (since <code>async</code> function always completes). Therefore you have to be careful when accessing the instance&#x27;s member in async functions.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="memory-leak-with-coroutine">Memory Leak With Coroutine<a href="#memory-leak-with-coroutine" class="hash-link" aria-label="Direct link to Memory Leak With Coroutine" title="Direct link to Memory Leak With Coroutine">​</a></h4>
<p>On the other hand, Coroutines might result in <span class="orange-bold">memory leak</span> if not used properly since it does not exit if the gameObject has been destroyed. Assets in Unity (textures, materials, etc) are <span class="orange-bold">not</span> garbage collected as readily as other types. Unity will clean up unused assets on scene loads, but to keep them from piling up it&#x27;s our responsibility to manage the assets we&#x27;re creating, and <code>Destroy()</code> them when we&#x27;re finished.</p>
<p>In the following example, the <code>finally</code> block never gets executed and thus results in memory leak.</p>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token return-type class-name">IEnumerator</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">RenderEffect</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token class-name">UnityEngine</span><span class="token class-name punctuation" style="color:#6c6783">.</span><span class="token class-name">UI</span><span class="token class-name punctuation" style="color:#6c6783">.</span><span class="token class-name">RawImage</span><span class="token plain"> r</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token class-name keyword" style="color:#ffcc99">var</span><span class="token plain"> texture </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">RenderTexture</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token number" style="color:#e09142">1024</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1024</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token keyword" style="color:#ffcc99">try</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token keyword" style="color:#ffcc99">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token class-name keyword" style="color:#ffcc99">int</span><span class="token plain"> i </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> i </span><span class="token operator" style="color:#e09142">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#e09142">1000</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> i</span><span class="token operator" style="color:#e09142">++</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                </span><span class="token comment" style="color:#6c6783">// do something with r and texture</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                </span><span class="token comment" style="color:#6c6783">// then give control back to Unity after one interation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                </span><span class="token keyword" style="color:#ffcc99">yield</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">return</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">null</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token keyword" style="color:#ffcc99">finally</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            texture</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Release</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="stopping-async-functions">Stopping Async Functions<a href="#stopping-async-functions" class="hash-link" aria-label="Direct link to Stopping Async Functions" title="Direct link to Stopping Async Functions">​</a></h3>
<p>To be sure that Coroutines always exit especially on destroyed GameObjects, we need to be mindful to <code>StopCoroutine(...)</code> during <code>onDisable</code> of the GameObject. Likewise, we can also cancel the running of async functions using cancellation <strong>tokens</strong>.</p>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// declare and initialise at Start()</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token class-name">CancellationTokenSource</span><span class="token plain"> token</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token return-type class-name keyword" style="color:#ffcc99">void</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">Start</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        token </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">CancellationTokenSource</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token keyword" style="color:#ffcc99">async</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#ffcc99">void</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">PerformCalculation</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// passed the token when defining Task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token class-name keyword" style="color:#ffcc99">var</span><span class="token plain"> result </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">await</span><span class="token plain"> Task</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Run</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            calculationState </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ffcc99">true</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token class-name keyword" style="color:#ffcc99">float</span><span class="token class-name punctuation" style="color:#6c6783">[</span><span class="token class-name punctuation" style="color:#6c6783">,</span><span class="token class-name punctuation" style="color:#6c6783">]</span><span class="token plain"> mapValues </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name keyword" style="color:#ffcc99">float</span><span class="token punctuation" style="color:#6c6783">[</span><span class="token plain">size</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:#6c6783">]</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token comment" style="color:#6c6783">// ... implementation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token keyword" style="color:#ffcc99">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token range operator" style="color:#e09142">..</span><span class="token range operator" style="color:#e09142">..</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                </span><span class="token comment" style="color:#6c6783">// ... implementation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                </span><span class="token comment" style="color:#6c6783">// periodically check for cancellation token request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                </span><span class="token keyword" style="color:#ffcc99">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">IsCancellationRequested</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                    Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Task Stop Requested&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                    </span><span class="token keyword" style="color:#ffcc99">return</span><span class="token plain"> mapValues</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">                    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token keyword" style="color:#ffcc99">return</span><span class="token plain"> result</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token punctuation" style="color:#6c6783">,</span><span class="token plain"> token</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">Token</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// token passed as second argument of Task.Run()</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// set the token to Cancel the function on object disable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token return-type class-name keyword" style="color:#ffcc99">void</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">OnDisable</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;itemDisabled&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        token</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Cancel</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="return-values">Return Values<a href="#return-values" class="hash-link" aria-label="Direct link to Return Values" title="Direct link to Return Values">​</a></h3>
<p>We cannot return anything in a Coroutine, but async functions can the following return types (thats why we can <code>await</code> its results!):</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/dotnet/api/system.threading.tasks.task?view=net-7.0" target="_blank" rel="noopener noreferrer">Task</a>, for an async method that performs an operation but returns no value.</li>
<li><a href="https://learn.microsoft.com/en-us/dotnet/api/system.threading.tasks.task-1?view=net-7.0" target="_blank" rel="noopener noreferrer">Task&lt;TResult&gt;</a>, for an async method that returns a value.</li>
<li><code>void</code>, for an event handler.</li>
</ul>
<p>For example, the following async function returns a <code>Sprite</code> placed at a <code>path</code>.</p>
<div class="theme-admonition theme-admonition-note alert alert--secondary admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Resource Path</div><div class="admonitionContent_vXIg"><p>Using <code>Resources.Load</code> or <code>Resources.LoadAsync</code>, you can load an asset of the requested <code>type</code> stored at a <code>path</code> in the <code>Resources</code> folder. You must first create the <code>Assets/Resources</code> folder for this to work. Note that the <code>path</code> is case insensitive and must <span class="orange-bold">not</span> contain a file extension. <a href="https://docs.unity3d.com/ScriptReference/Resources.Load.html" target="_blank" rel="noopener noreferrer">Read the full documentation here</a>.</p></div></div>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token keyword" style="color:#ffcc99">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token return-type class-name punctuation" style="color:#6c6783">&lt;</span><span class="token return-type class-name">Sprite</span><span class="token return-type class-name punctuation" style="color:#6c6783">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">LoadAsSprite_Task</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token class-name keyword" style="color:#ffcc99">string</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// getting sprite inside Assets/Resources/ folder</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token class-name keyword" style="color:#ffcc99">var</span><span class="token plain"> resource </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">await</span><span class="token plain"> Resources</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token generic-method function" style="color:#9a86fd">LoadAsync</span><span class="token generic-method generic class-name punctuation" style="color:#6c6783">&lt;</span><span class="token generic-method generic class-name">Sprite</span><span class="token generic-method generic class-name punctuation" style="color:#6c6783">&gt;</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token keyword" style="color:#ffcc99">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">resource </span><span class="token keyword" style="color:#ffcc99">as</span><span class="token plain"> </span><span class="token class-name">Sprite</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We can call them as such in <code>Start()</code> (notice how the Start method has to be <code>async</code> now to <code>await</code> this <code>Task</code>), and print some quick test in <code>Update()</code> to confirm if <code>Update()</code> is run at least for <strong>one</strong> frame before <code>Start()</code> is continued, and we can obtain some information about the return value of <code>LoadAsSprite_Task</code> async function. Here&#x27;s an example:</p>
<div class="language-cs codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#2a2734;--prism-color:#9a86fd"><div class="codeBlockTitle_Ktv7">AsyncReturnValue.cs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cs codeBlock_bY9V thin-scrollbar" style="background-color:#2a2734;color:#9a86fd"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">.</span><span class="token namespace" style="opacity:0.7">Collections</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">.</span><span class="token namespace" style="opacity:0.7">Collections</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">.</span><span class="token namespace" style="opacity:0.7">Generic</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">UnityEngine</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">.</span><span class="token namespace" style="opacity:0.7">Threading</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">using</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">System</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">.</span><span class="token namespace" style="opacity:0.7">Threading</span><span class="token namespace punctuation" style="opacity:0.7;color:#6c6783">.</span><span class="token namespace" style="opacity:0.7">Tasks</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token keyword" style="color:#ffcc99">public</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">class</span><span class="token plain"> </span><span class="token class-name">AsyncReturnValue</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">:</span><span class="token plain"> </span><span class="token type-list class-name">MonoBehaviour</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token comment" style="color:#6c6783">// Start is called before the first frame update</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token keyword" style="color:#ffcc99">private</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#ffcc99">bool</span><span class="token plain"> testTask </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ffcc99">false</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token keyword" style="color:#ffcc99">private</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#ffcc99">int</span><span class="token plain"> frame </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token number" style="color:#e09142">0</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token keyword" style="color:#ffcc99">async</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#ffcc99">void</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">Start</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Start method begins...&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token class-name">Sprite</span><span class="token plain"> s </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc99">await</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">LoadAsSprite_Task</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Sprites/play-button&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"> </span><span class="token comment" style="color:#6c6783">// the actual file is at Assets/Resources/play-button.png</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        testTask </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ffcc99">true</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;The sprite: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">+</span><span class="token plain"> s</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">name </span><span class="token operator" style="color:#e09142">+</span><span class="token plain"> </span><span class="token string" style="color:#ffcc99">&quot; has been loaded.&quot;</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Start method completes in frame: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">+</span><span class="token plain"> frame</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">ToString</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token return-type class-name keyword" style="color:#ffcc99">void</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">Update</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        frame</span><span class="token operator" style="color:#e09142">++</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token keyword" style="color:#ffcc99">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token operator" style="color:#e09142">!</span><span class="token plain">testTask</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            Debug</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Log</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token string" style="color:#ffcc99">&quot;Update called at frame: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#e09142">+</span><span class="token plain"> frame</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token keyword" style="color:#ffcc99">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token return-type class-name punctuation" style="color:#6c6783">&lt;</span><span class="token return-type class-name">Sprite</span><span class="token return-type class-name punctuation" style="color:#6c6783">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#9a86fd">LoadAsSprite_Task</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token class-name keyword" style="color:#ffcc99">string</span><span class="token plain"> path</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// getting sprite inside Assets/Resources/ folder</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token class-name">ResourceRequest</span><span class="token plain"> request </span><span class="token operator" style="color:#e09142">=</span><span class="token plain"> Resources</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token generic-method function" style="color:#9a86fd">LoadAsync</span><span class="token generic-method generic class-name punctuation" style="color:#6c6783">&lt;</span><span class="token generic-method generic class-name">Sprite</span><span class="token generic-method generic class-name punctuation" style="color:#6c6783">&gt;</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token comment" style="color:#6c6783">// While the request is not done, yield to Unity&#x27;s coroutine system.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token keyword" style="color:#ffcc99">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token operator" style="color:#e09142">!</span><span class="token plain">request</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">isDone</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">            </span><span class="token keyword" style="color:#ffcc99">await</span><span class="token plain"> Task</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token function" style="color:#9a86fd">Yield</span><span class="token punctuation" style="color:#6c6783">(</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">        </span><span class="token keyword" style="color:#ffcc99">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#6c6783">(</span><span class="token plain">Sprite</span><span class="token punctuation" style="color:#6c6783">)</span><span class="token plain">request</span><span class="token punctuation" style="color:#6c6783">.</span><span class="token plain">asset</span><span class="token punctuation" style="color:#6c6783">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain">    </span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain"></span><span class="token punctuation" style="color:#6c6783">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Here&#x27;s the console output:</p>
<section><img src="/50033/assets/images/2023-09-15-17-59-59-21283c50f10d6340181c8c8f33786474.png" class="center_image_tcFY" style="width:100%"></section>
<p>It shows that <code>Start</code> is called first as usual, but <strong>asynchronously</strong>, allowing <code>Update</code> to advance and increase the frame value. When the sprite has been loaded, the Start method resumes and print the <code>Start method completes</code> message.</p>
<div class="theme-admonition theme-admonition-warning alert alert--danger admonition_WoCw"><div class="admonitionHeading_TMsN"><span class="admonitionIcon_Ibzs"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_vXIg"><p>We can&#x27;t <code>await</code> a Coroutine, it does not make sense because Unity&#x27;s coroutines are not Task-based and don&#x27;t return a Task object that you can <code>await</code>. However you can achieve similar result such as using a flag that will be set to <code>true</code> once a Coroutine completes.</p></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2>
<p>Choosing between coroutines and async/await Task isn&#x27;t always straightforward due to their differing functionalities.</p>
<p>It&#x27;s essential to understand that asynchronous code <span class="orange-bold">doesn&#x27;t always imply multithreading</span>, and the behavior can vary depending on the specific APIs and libraries you&#x27;re working with.</p>
<p>Coroutines are best for <em>fire-and-forget</em> tasks like fading the screen, replenishing health bar, triggering explosion on crates two seconds after it collides with the player and similar tasks, while async is essential for processing intensive tasks in the background <em>without</em> causing game stalls. Coroutines can be <strong>tricky</strong>, but async functions can get <strong>complex</strong> when handling task cancellation. In practice, using both methods in your project is common. As a broadly general rule, it may be simpler to employ coroutines for object-related game logic and reserve async for situations like executing lengthy background tasks.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="powerup-bug">Fix The Powerup Bug<a href="#powerup-bug" class="hash-link" aria-label="Direct link to Fix The Powerup Bug" title="Direct link to Fix The Powerup Bug">​</a></h2>
<p>If you follow the tutorial exactly, you will have a particular powerup bug. While our powerup works at first glance, having the collider placed above the box will cause problems if Mario approached it from above as follows:</p>
<div class="center_div_ipNX"><video style="width:100%" class="center_video_QRNx" controls=""><source src="https://50033.s3.ap-southeast-1.amazonaws.com/week-4/bug-powerup.mp4" type="video/mp4">Your browser does not support the video tag.</video></div>
<p>The Starman powerup looks alright if we only collide with it from below, however it mistakenly collided with Mario even before spawned. On the other hand, the Magic Mushroom powerup didn&#x27;t have that.</p>
<p>You need to disable the collider and set its <code>RigidBody2D.type</code> to <code>static</code> at first, and then enable the collider and set the <code>RigidBody2D.type</code> to <code>dynamic</code> upon <code>SpawnPowerup()</code>. However, you can&#x27;t do it all in the same function because adding Impulse Force to a currently static body type will <span class="orange-bold">not work</span>. Even though you have changed its type to <code>dynamic</code> in this frame, the Engine does not know yet and so you technically need to wait until the <strong>next frame</strong> to add the Impulse force to move the powerup once spawned. You can utilise Coroutine or utilise <code>await Task.Delay()</code> for this.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/50033/docs/children/scriptableobjects"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Scriptable Objects</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/50033/docs/children/building"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Building Your Game</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#c-coroutines" class="table-of-contents__link toc-highlight">C#: Coroutines</a><ul><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a></li><li><a href="#yield-return" class="table-of-contents__link toc-highlight"><code>yield return</code></a></li><li><a href="#starting-multiple-coroutines" class="table-of-contents__link toc-highlight">Starting Multiple Coroutines</a></li><li><a href="#stopping-coroutines" class="table-of-contents__link toc-highlight">Stopping Coroutines</a></li></ul></li><li><a href="#async-methods" class="table-of-contents__link toc-highlight">C#: Async Methods and Multithreading With Task</a></li><li><a href="#comparison-with-coroutine" class="table-of-contents__link toc-highlight">Comparison With Coroutine</a><ul><li><a href="#async-functions-always-complete" class="table-of-contents__link toc-highlight">Async Functions Always Complete</a></li><li><a href="#stopping-async-functions" class="table-of-contents__link toc-highlight">Stopping Async Functions</a></li><li><a href="#return-values" class="table-of-contents__link toc-highlight">Return Values</a></li></ul></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#powerup-bug" class="table-of-contents__link toc-highlight">Fix The Powerup Bug</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 50.033 Game Design and Development</div></div></div></footer></div>
</body>
</html>